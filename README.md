# CVE Consumer Application

This is the CVE Consumer application that processes CVE records from a Kafka topic and stores them in a PostgreSQL database.

## Prerequisites

Before building and deploying the application locally, ensure you have the following installed:

1. **Go**: Version 1.22.3 or higher.
2. **Docker**: For setting up Kafka and PostgreSQL locally.
3. **Docker Compose**: For orchestrating multi-container Docker applications.
4. **Kafka**: You can use Docker to set up a local Kafka cluster.
5. **PostgreSQL**: You can use Docker to set up a local PostgreSQL database.

## Build Instructions

1. **Clone the Repository**

   ```bash
   git clone https://github.com/cyse7125-su24-team09/webapp-cve-processor.git
   cd cve-consumer
   ```

2. **Set Up Environment Variables**

   Create a `.env` file in the root directory of the project with the following content:

   ```env
   KAFKA_BROKERS=localhost:9092
   KAFKA_GROUP_ID=cve-consumer-group
   KAFKA_TOPIC=cve
   DB_HOST=localhost
   DB_PORT=5432
   DB_USERNAME=your_db_username
   DB_PASSWORD=your_db_password
   DB_NAME=cve_database
   ```

3. **Build the Application**

   ```bash
   go build -o cve-consumer cmd/app/main.go
   ```

## Deploy Instructions

### Using Docker Compose

1. **Create a Docker Compose File (`docker-compose.yml`)**

   ```yaml
   version: '3'
   services:
     zookeeper:
       image: wurstmeister/zookeeper:3.4.6
       ports:
         - "2181:2181"
     kafka:
       image: wurstmeister/kafka:2.12-2.3.0
       ports:
         - "9092:9092"
       environment:
         KAFKA_ADVERTISED_LISTENERS: INSIDE://kafka:9093,OUTSIDE://localhost:9092
         KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
         KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE
         KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
     postgres:
       image: postgres:13
       environment:
         POSTGRES_DB: cve_database
         POSTGRES_USER: your_db_username
         POSTGRES_PASSWORD: your_db_password
       ports:
         - "5432:5432"
   ```

2. **Start Docker Containers**

   ```bash
   docker-compose up -d
   ```

3. **Create Kafka Topic**

   ```bash
   docker exec -it <kafka_container_id> kafka-topics.sh --create --topic cve --partitions 3 --replication-factor 1 --if-not-exists --zookeeper zookeeper:2181
   ```

4. **Run the Application**

   ```bash
   ./cve-consumer
   ```

### Kubernetes Deployment

1. **Helm Chart Deployment**

   Create a Helm chart with the necessary configurations. Refer to the previous sections for Helm chart structure and configuration.

2. **Install Helm Chart**

   ```bash
   helm install cve-consumer ./helm-webapp-cve-consumer
   ```
